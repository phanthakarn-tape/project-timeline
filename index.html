<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Timeline (Customizable)</title>

    <!-- Tailwind CSS with Config -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class", // Enable class-based dark mode
        theme: {
          extend: {
            fontFamily: {
              sans: ["Sarabun", "sans-serif"],
            },
          },
        },
      }
    </script>

    <!-- React & ReactDOM -->
    <script
      src="https://unpkg.com/react@18/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
      crossorigin
    ></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      /* Base styles handled by Tailwind, adding specific overrides */
      .resizer {
        position: absolute;
        right: 0;
        top: 0;
        height: 100%;
        width: 4px;
        cursor: col-resize;
        z-index: 50;
        transition: background 0.2s;
      }
      .resizer:hover,
      .resizing {
        background-color: #3b82f6;
      }
      .cursor-grab {
        cursor: grab;
      }
      .cursor-grabbing {
        cursor: grabbing;
      }

      /* Custom Scrollbar for Dark Mode compatibility */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      .dark ::-webkit-scrollbar-thumb {
        background: #475569;
      }
      .dark ::-webkit-scrollbar-thumb:hover {
        background: #64748b;
      }

      /* Loading Overlay */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 100;
      }
      .dark .loading-overlay {
        background: rgba(15, 23, 42, 0.9);
      }

      .spinner {
        border: 3px solid #e2e8f0;
        border-top: 3px solid #3b82f6;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
      }
      .dark .spinner {
        border-color: #334155;
        border-top-color: #60a5fa;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Animations */
      .animate-fade-in {
        animation: fadeIn 0.5s ease-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .bar-grow {
        animation: barGrow 1s ease-out forwards;
        transform-origin: bottom;
        transform: scaleY(0);
      }
      @keyframes barGrow {
        to {
          transform: scaleY(1);
        }
      }

      /* Toggle Switch */
      .toggle-checkbox:checked {
        right: 0;
        border-color: #3b82f6;
      }
      .toggle-checkbox:checked + .toggle-label {
        background-color: #3b82f6;
      }
    </style>
  </head>
  <body
    class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200 transition-colors duration-300"
  >
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useRef, useEffect, useMemo, useCallback } = React

      // --- Icons ---
      const CalendarIcon = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="1.5"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <rect width="18" height="18" x="3" y="4" rx="2" ry="2" />
          <line x1="16" x2="16" y1="2" y2="6" />
          <line x1="8" x2="8" y1="2" y2="6" />
          <line x1="3" x2="21" y1="10" y2="10" />
        </svg>
      )
      const PlusIcon = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="1.5"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M5 12h14" />
          <path d="M12 5v14" />
        </svg>
      )
      const TrashIcon = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="1.5"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M3 6h18" />
          <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
          <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
        </svg>
      )
      const GripVerticalIcon = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="1.5"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <circle cx="9" cy="12" r="1" />
          <circle cx="9" cy="5" r="1" />
          <circle cx="9" cy="19" r="1" />
          <circle cx="15" cy="12" r="1" />
          <circle cx="15" cy="5" r="1" />
          <circle cx="15" cy="19" r="1" />
        </svg>
      )
      const XCircleIcon = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="1.5"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <circle cx="12" cy="12" r="10" />
          <path d="m15 9-6 6" />
          <path d="m9 9 6 6" />
        </svg>
      )
      const SaveIcon = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="1.5"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
          <polyline points="17 21 17 13 7 13 7 21" />
          <polyline points="7 3 7 8 15 8" />
        </svg>
      )
      const SheetIcon = ({ connected }) =>
        connected ? (
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="12"
            height="12"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
            className="text-emerald-500"
          >
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14 2 14 8 20 8" />
            <line x1="16" y1="13" x2="8" y2="13" />
            <line x1="16" y1="17" x2="8" y2="17" />
            <polyline points="10 9 9 9 8 9" />
          </svg>
        ) : (
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="12"
            height="12"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
            className="text-slate-400 dark:text-slate-500"
          >
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14 2 14 8 20 8" />
            <line x1="2" y1="2" x2="22" y2="22" />
          </svg>
        )
      const SettingsIcon = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="1.5"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <circle cx="12" cy="12" r="3" />
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
        </svg>
      )
      const LayoutIcon = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="1.5"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <rect width="18" height="18" x="3" y="3" rx="2" ry="2" />
          <line x1="3" x2="21" y1="9" y2="9" />
          <line x1="9" x2="9" y1="21" y2="9" />
        </svg>
      )
      const BarChartIcon = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="1.5"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <line x1="12" x2="12" y1="20" y2="10" />
          <line x1="18" x2="18" y1="20" y2="4" />
          <line x1="6" x2="6" y1="20" y2="16" />
        </svg>
      )
      const MoonIcon = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
        </svg>
      )
      const SunIcon = () => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
        >
          <circle cx="12" cy="12" r="4" />
          <path d="M12 2v2" />
          <path d="M12 20v2" />
          <path d="m4.93 4.93 1.41 1.41" />
          <path d="m17.66 17.66 1.41 1.41" />
          <path d="M2 12h2" />
          <path d="M20 12h2" />
          <path d="m6.34 17.66-1.41 1.41" />
          <path d="m19.07 4.93-1.41 1.41" />
        </svg>
      )

      // --- Defaults ---
      const generateInitialColumns = () => {
        const baseSlots = [
          { day: "MON", time: "8.30-17.30" },
          { day: "TUE", time: "00.01-05.00" },
          { day: "TUE", time: "12.00-17.30" },
          { day: "WED", time: "00.01-05.00" },
          { day: "WED", time: "12.00-17.30" },
          { day: "THU", time: "00.01-05.00" },
          { day: "THU", time: "12.00-17.30" },
          { day: "FRI", time: "00.01-05.00" },
          { day: "FRI", time: "12.00-17.30" },
        ]
        let cols = []
        let idCounter = 0
        baseSlots.forEach((s) =>
          cols.push({ ...s, weekId: "w1", id: `col-${idCounter++}` })
        )
        baseSlots.forEach((s) =>
          cols.push({ ...s, weekId: "w2", id: `col-${idCounter++}` })
        )
        return cols
      }

      const defaultTasks = [{ id: 1, name: "BKK to CMI", activeSlots: [] }]
      const defaultWeekLabels = { w1: "Week 1", w2: "Week 2" }
      const initialProject = {
        id: "default",
        name: "Default Project",
        columns: generateInitialColumns(),
        weekLabels: defaultWeekLabels,
        tasks: defaultTasks,
      }

      // --- Toggle Switch Component ---
      const ToggleSwitch = ({ label, checked, onChange, icon }) => (
        <div className="flex items-center justify-between py-2">
          <div className="flex items-center gap-2 text-slate-700 dark:text-slate-300">
            {icon}
            <span className="text-sm font-medium">{label}</span>
          </div>
          <div className="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
            <input
              type="checkbox"
              name="toggle"
              id={`toggle-${label}`}
              checked={checked}
              onChange={(e) => onChange(e.target.checked)}
              className="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-300 dark:border-slate-600 transition-all duration-300 checked:right-0 checked:border-blue-500"
              style={{
                top: 0,
                left: checked ? "auto" : 0,
                right: checked ? 0 : "auto",
              }}
            />
            <label
              htmlFor={`toggle-${label}`}
              className={`toggle-label block overflow-hidden h-5 rounded-full cursor-pointer transition-colors duration-300 ${
                checked ? "bg-blue-500" : "bg-slate-300 dark:bg-slate-600"
              }`}
            ></label>
          </div>
        </div>
      )

      // --- Modal Component ---
      const Modal = ({ isOpen, onClose, title, children }) => {
        if (!isOpen) return null
        return (
          <div className="fixed inset-0 bg-slate-900/50 dark:bg-black/70 flex items-center justify-center z-[100] backdrop-blur-sm transition-all">
            <div className="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded shadow-2xl w-full max-w-md animate-fade-in">
              <div className="px-4 py-3 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                <h2 className="text-sm font-semibold text-slate-800 dark:text-white">
                  {title}
                </h2>
                <button
                  onClick={onClose}
                  className="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200"
                >
                  <XCircleIcon />
                </button>
              </div>
              <div className="p-4">{children}</div>
              <div className="px-4 py-3 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-2 rounded-b">
                <button
                  onClick={onClose}
                  className="px-3 py-1.5 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 bg-white dark:bg-slate-700 hover:bg-slate-50 dark:hover:bg-slate-600 rounded text-xs font-medium transition-colors"
                >
                  Close
                </button>
              </div>
            </div>
          </div>
        )
      }

      // --- Dashboard Component ---
      const DashboardView = ({ project, isCompact }) => {
        // Calculations
        const totalTasks = project.tasks.length
        const totalSlots = project.tasks.reduce(
          (acc, t) => acc + t.activeSlots.length,
          0
        )
        const dayCounts = {}
        const weekCounts = {}

        project.tasks.forEach((t) => {
          t.activeSlots.forEach((slotId) => {
            const col = project.columns.find((c) => c.id === slotId)
            if (col) {
              const d = col.day.toUpperCase()
              dayCounts[d] = (dayCounts[d] || 0) + 1
              const w = col.weekId
              weekCounts[w] = (weekCounts[w] || 0) + 1
            }
          })
        })

        let maxCount = 0
        let busiestDay = "-"
        Object.entries(dayCounts).forEach(([day, count]) => {
          if (count > maxCount) {
            maxCount = count
            busiestDay = day
          }
        })

        const topTasks = [...project.tasks]
          .sort((a, b) => b.activeSlots.length - a.activeSlots.length)
          .slice(0, 5)
        const daysOrder = ["MON", "TUE", "WED", "THU", "FRI"]
        const maxDayVal = Math.max(...Object.values(dayCounts), 1)
        const weekKeys = Object.keys(project.weekLabels)
        const totalWeekSlots =
          Object.values(weekCounts).reduce((a, b) => a + b, 0) || 1

        const cardPadding = isCompact ? "p-3" : "p-5"
        const cardHeight = isCompact ? "h-40" : "h-52"

        return (
          <div className="p-4 animate-fade-in bg-slate-50 dark:bg-slate-900/50 min-h-full">
            {/* Summary Cards */}
            <div className="grid grid-cols-1 md:grid-cols-4 gap-3 mb-4">
              {[
                {
                  label: "Total Tasks",
                  val: totalTasks,
                  sub: "Active items",
                  color: "text-slate-800 dark:text-white",
                },
                {
                  label: "Total Work Slots",
                  val: totalSlots,
                  sub: "Scheduled blocks",
                  color: "text-blue-700 dark:text-blue-400",
                },
                {
                  label: "Busiest Day",
                  val: busiestDay,
                  sub: `${maxCount} slots`,
                  color: "text-slate-800 dark:text-white",
                },
                {
                  label: "Completion",
                  val: `${
                    totalSlots > 0
                      ? Math.min(
                          100,
                          Math.round((totalSlots / (totalTasks * 5)) * 100)
                        )
                      : 0
                  }%`,
                  sub: "Est. capacity",
                  color: "text-emerald-600 dark:text-emerald-400",
                },
              ].map((item, idx) => (
                <div
                  key={idx}
                  className={`bg-white dark:bg-slate-800 ${cardPadding} rounded border border-slate-200 dark:border-slate-700 shadow-sm flex flex-col items-center justify-center`}
                >
                  <div className="text-slate-400 text-[10px] font-bold uppercase tracking-widest mb-1">
                    {item.label}
                  </div>
                  <div className={`text-2xl font-bold ${item.color}`}>
                    {item.val}
                  </div>
                  <div className="text-[10px] text-slate-400">{item.sub}</div>
                </div>
              ))}
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-3">
              {/* Chart 1 */}
              <div
                className={`bg-white dark:bg-slate-800 ${cardPadding} rounded border border-slate-200 dark:border-slate-700 shadow-sm lg:col-span-2`}
              >
                <h3 className="text-sm font-bold text-slate-800 dark:text-slate-200 mb-3 border-b border-slate-100 dark:border-slate-700 pb-2">
                  Daily Workload
                </h3>
                <div
                  className={`${cardHeight} flex items-end justify-between gap-2 px-2 pb-2 border-l border-b border-slate-200 dark:border-slate-700`}
                >
                  {daysOrder.map((day) => {
                    const count = dayCounts[day] || 0
                    const heightPercent = (count / maxDayVal) * 100
                    return (
                      <div
                        key={day}
                        className="flex flex-col items-center flex-1 h-full justify-end group"
                      >
                        <div className="relative w-full max-w-[40px] bg-blue-50 dark:bg-blue-900/30 rounded-t-sm overflow-hidden h-full flex items-end">
                          <div
                            className="w-full bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-400 transition-all duration-500 bar-grow relative"
                            style={{ height: `${heightPercent}%` }}
                          >
                            <div className="absolute -top-6 w-full text-center text-[10px] font-bold text-blue-700 dark:text-blue-300 opacity-0 group-hover:opacity-100 transition-opacity">
                              {count}
                            </div>
                          </div>
                        </div>
                        <div className="mt-2 text-[10px] font-bold text-slate-500 dark:text-slate-400">
                          {day}
                        </div>
                      </div>
                    )
                  })}
                </div>
              </div>

              {/* Chart 2 */}
              <div
                className={`bg-white dark:bg-slate-800 ${cardPadding} rounded border border-slate-200 dark:border-slate-700 shadow-sm flex flex-col`}
              >
                <h3 className="text-sm font-bold text-slate-800 dark:text-slate-200 mb-3 border-b border-slate-100 dark:border-slate-700 pb-2">
                  Weekly Split
                </h3>
                <div className="flex-1 flex flex-col justify-center items-center">
                  <div
                    className="relative w-32 h-32 rounded-full flex items-center justify-center border-4 border-slate-50 dark:border-slate-700"
                    style={{
                      background: `conic-gradient(#2563eb 0% ${
                        ((weekCounts[weekKeys[0]] || 0) / totalWeekSlots) * 100
                      }%, #94a3b8 ${
                        ((weekCounts[weekKeys[0]] || 0) / totalWeekSlots) * 100
                      }% 100%)`,
                    }}
                  >
                    <div className="absolute w-20 h-20 bg-white dark:bg-slate-800 rounded-full flex flex-col items-center justify-center">
                      <span className="text-xl font-bold text-slate-800 dark:text-white">
                        {totalWeekSlots}
                      </span>
                      <span className="text-[9px] text-slate-400 uppercase">
                        Slots
                      </span>
                    </div>
                  </div>
                  <div className="mt-4 w-full space-y-2">
                    {weekKeys.map((wk, idx) => (
                      <div
                        key={wk}
                        className="flex justify-between items-center text-xs"
                      >
                        <div className="flex items-center gap-2">
                          <span
                            className={`w-2 h-2 rounded-full ${
                              idx === 0 ? "bg-blue-600" : "bg-slate-400"
                            }`}
                          ></span>
                          <span className="text-slate-600 dark:text-slate-400 font-medium truncate max-w-[100px]">
                            {project.weekLabels[wk] || wk}
                          </span>
                        </div>
                        <span className="font-bold text-slate-800 dark:text-slate-200">
                          {weekCounts[wk] || 0}
                        </span>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Chart 3 */}
              <div
                className={`bg-white dark:bg-slate-800 ${cardPadding} rounded border border-slate-200 dark:border-slate-700 shadow-sm lg:col-span-3`}
              >
                <h3 className="text-sm font-bold text-slate-800 dark:text-slate-200 mb-3 border-b border-slate-100 dark:border-slate-700 pb-2">
                  Top Tasks
                </h3>
                <div className="space-y-3">
                  {topTasks.map((task, idx) => (
                    <div key={task.id} className="flex items-center gap-3">
                      <div className="w-6 text-xs font-bold text-slate-400">
                        #{idx + 1}
                      </div>
                      <div className="flex-1">
                        <div className="flex justify-between mb-1">
                          <span className="text-xs font-semibold text-slate-700 dark:text-slate-300 truncate">
                            {task.name}
                          </span>
                          <span className="text-[10px] text-slate-500 font-medium">
                            {task.activeSlots.length} slots
                          </span>
                        </div>
                        <div className="w-full bg-slate-100 dark:bg-slate-700 rounded-full h-1.5">
                          <div
                            className="bg-emerald-500 h-1.5 rounded-full"
                            style={{
                              width: `${
                                (task.activeSlots.length /
                                  (topTasks[0]?.activeSlots.length || 1)) *
                                100
                              }%`,
                            }}
                          ></div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        )
      }

      // --- Main App ---
      const ProjectTimelineDashboard = () => {
        // Data State
        const [projects, setProjects] = useState([initialProject])
        const [activeProjectId, setActiveProjectId] = useState("default")

        // App State
        const [view, setView] = useState("timeline")
        const [scriptUrl, setScriptUrl] = useState("")
        const [isConnected, setIsConnected] = useState(false)
        const [isLoading, setIsLoading] = useState(false)
        const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false)
        const [isSettingsOpen, setIsSettingsOpen] = useState(false)
        const [sidebarWidth, setSidebarWidth] = useState(250)

        // Preference State
        const [isDarkMode, setIsDarkMode] = useState(false)
        const [isCompact, setIsCompact] = useState(true)

        const sidebarRef = useRef(null)
        const isResizing = useRef(false)
        const dragItem = useRef()

        const activeProject = useMemo(
          () => projects.find((p) => p.id === activeProjectId) || projects[0],
          [projects, activeProjectId]
        )

        // --- Init & Load ---
        useEffect(() => {
          // Load Preferences
          const savedDark = localStorage.getItem("pref_dark_mode") === "true"
          setIsDarkMode(savedDark)
          if (savedDark) document.documentElement.classList.add("dark")

          const savedCompact = localStorage.getItem("pref_compact_mode")
          if (savedCompact !== null) setIsCompact(savedCompact === "true")

          // Load Data
          const savedUrl = localStorage.getItem("google_script_url")
          if (savedUrl) {
            setScriptUrl(savedUrl)
            loadFromSheet(savedUrl)
          } else {
            const localBackup = localStorage.getItem("timeline_local_backup")
            if (localBackup) {
              const data = JSON.parse(localBackup)
              setProjects(data.projects)
              setActiveProjectId(data.activeProjectId)
              setHasUnsavedChanges(true)
            }
          }
        }, [])

        // --- Effect: Preferences ---
        useEffect(() => {
          if (isDarkMode) document.documentElement.classList.add("dark")
          else document.documentElement.classList.remove("dark")
          localStorage.setItem("pref_dark_mode", isDarkMode)
        }, [isDarkMode])

        useEffect(() => {
          localStorage.setItem("pref_compact_mode", isCompact)
        }, [isCompact])

        // --- Auto Backup ---
        useEffect(() => {
          if (isLoading) return
          const dataToSave = { projects, activeProjectId }
          localStorage.setItem(
            "timeline_local_backup",
            JSON.stringify(dataToSave)
          )
          if (isConnected) setHasUnsavedChanges(true)
        }, [projects, activeProjectId])

        // --- API Handlers ---
        const loadFromSheet = async (url) => {
          if (!url) return
          setIsLoading(true)
          try {
            const cleanUrl = url.trim()
            const res = await fetch(cleanUrl)
            const data = await res.json()
            if (data.projects && Array.isArray(data.projects)) {
              setProjects(data.projects)
              if (data.activeProjectId) setActiveProjectId(data.activeProjectId)
              setIsConnected(true)
              setHasUnsavedChanges(false)
            } else if (data.empty) setIsConnected(true)
          } catch (e) {
            console.error(e)
            alert("Connection failed!")
            setIsConnected(false)
          } finally {
            setIsLoading(false)
          }
        }

        const saveToSheet = async () => {
          if (!scriptUrl) {
            setIsSettingsOpen(true)
            return
          }
          setIsLoading(true)
          const dataToSave = {
            projects,
            activeProjectId,
            lastUpdated: new Date().toISOString(),
          }
          try {
            const cleanUrl = scriptUrl.trim()
            const res = await fetch(cleanUrl, {
              method: "POST",
              redirect: "follow",
              headers: { "Content-Type": "text/plain;charset=utf-8" },
              body: JSON.stringify(dataToSave),
            })
            const result = await res.json()
            if (result.result === "success") {
              setHasUnsavedChanges(false)
              alert("Saved successfully.")
            } else throw new Error(result.error)
          } catch (e) {
            alert("Save failed: " + e.message)
          } finally {
            setIsLoading(false)
          }
        }

        const handleConnect = () => {
          if (!scriptUrl) return alert("Please enter a URL")
          const cleanUrl = scriptUrl.trim()
          localStorage.setItem("google_script_url", cleanUrl)
          loadFromSheet(cleanUrl)
          setIsSettingsOpen(false) // Do NOT close modal if only connecting? No, user might want to adjust toggles.
          // Actually, let's keep modal open or just confirm connection.
          // For better UX, let's just show status in modal or close it if success.
          // Here I'll close it for simplicity as per request context "Config Web App URL".
        }

        // --- Data Logic (Shortened for brevity as logic is same) ---
        const updateActiveProject = (newData) =>
          setProjects((prev) =>
            prev.map((p) =>
              p.id === activeProjectId ? { ...p, ...newData } : p
            )
          )
        const handleCreateProject = () => {
          const name = prompt("Project Name:")
          if (name) {
            const newProj = {
              ...initialProject,
              id: "proj-" + Date.now(),
              name,
            }
            setProjects([...projects, newProj])
            setActiveProjectId(newProj.id)
          }
        }
        const handleDeleteProject = () => {
          if (projects.length <= 1) return alert("Cannot delete last project")
          if (confirm("Delete?")) {
            const filtered = projects.filter((p) => p.id !== activeProjectId)
            setProjects(filtered)
            setActiveProjectId(filtered[0].id)
          }
        }
        const handleTaskNameChange = (id, val) =>
          updateActiveProject({
            tasks: activeProject.tasks.map((t) =>
              t.id === id ? { ...t, name: val } : t
            ),
          })
        const toggleSlot = (taskId, colId) =>
          updateActiveProject({
            tasks: activeProject.tasks.map((t) =>
              t.id === taskId
                ? {
                    ...t,
                    activeSlots: t.activeSlots.includes(colId)
                      ? t.activeSlots.filter((x) => x !== colId)
                      : [...t.activeSlots, colId],
                  }
                : t
            ),
          })
        const addTask = () =>
          updateActiveProject({
            tasks: [
              ...activeProject.tasks,
              {
                id:
                  (activeProject.tasks.length
                    ? Math.max(...activeProject.tasks.map((t) => t.id))
                    : 0) + 1,
                name: "New Task",
                activeSlots: [],
              },
            ],
          })
        const deleteTask = (id) =>
          updateActiveProject({
            tasks: activeProject.tasks.filter((t) => t.id !== id),
          })
        const handleTimeChange = (colId, val) =>
          updateActiveProject({
            columns: activeProject.columns.map((c) =>
              c.id === colId ? { ...c, time: val } : c
            ),
          })
        const handleWeekLabelChange = (wId, val) =>
          updateActiveProject({
            weekLabels: { ...activeProject.weekLabels, [wId]: val },
          })
        const deleteColumn = (colId) => {
          if (confirm("Delete column?"))
            updateActiveProject({
              columns: activeProject.columns.filter((c) => c.id !== colId),
              tasks: activeProject.tasks.map((t) => ({
                ...t,
                activeSlots: t.activeSlots.filter((x) => x !== colId),
              })),
            })
        }

        // --- Resize & Drag ---
        const startResizing = () => {
          isResizing.current = true
          document.body.style.cursor = "col-resize"
          document.addEventListener("mousemove", handleMouseMove)
          document.addEventListener("mouseup", stopResizing)
        }
        const handleMouseMove = (e) => {
          if (isResizing.current && sidebarRef.current) {
            const w =
              e.clientX - sidebarRef.current.getBoundingClientRect().left
            if (w > 100 && w < 600) setSidebarWidth(w)
          }
        }
        const stopResizing = () => {
          isResizing.current = false
          document.body.style.cursor = "default"
          document.removeEventListener("mousemove", handleMouseMove)
          document.removeEventListener("mouseup", stopResizing)
        }
        const handleDragStart = (e, index) => {
          if (e.target.tagName === "INPUT") {
            e.preventDefault()
            return
          }
          dragItem.current = index
        }
        const handleDragEnter = (e, index) => {
          if (dragItem.current === null || dragItem.current === index) return
          const newTasks = [...activeProject.tasks]
          const dragged = newTasks[dragItem.current]
          newTasks.splice(dragItem.current, 1)
          newTasks.splice(index, 0, dragged)
          dragItem.current = index
          updateActiveProject({ tasks: newTasks })
        }

        const weeks = useMemo(() => {
          const g = {}
          activeProject.columns.forEach((c) => {
            if (!g[c.weekId]) g[c.weekId] = []
            g[c.weekId].push(c)
          })
          return g
        }, [activeProject.columns])

        // --- Dynamic Styles based on Compact Mode ---
        const styles = {
          rowHeight: isCompact ? "h-7" : "h-10",
          headerHeight: isCompact ? "h-7" : "h-10",
          cellPadding: isCompact ? "p-0" : "p-1",
          fontSize: isCompact ? "text-[10px]" : "text-xs",
          inputFontSize: isCompact ? "text-[9px]" : "text-[11px]",
          iconSize: isCompact ? 14 : 16,
          headerText: isCompact ? "text-[10px]" : "text-xs",
          topBarPadding: isCompact ? "py-1.5" : "py-2.5",
          gripWidth: isCompact ? 36 : 40,
        }

        return (
          <div
            className={`min-h-screen bg-slate-50 dark:bg-slate-900 font-sans text-slate-800 dark:text-slate-200 ${
              isCompact ? "text-xs" : "text-sm"
            }`}
          >
            {isLoading && (
              <div className="loading-overlay">
                <div className="spinner mb-4"></div>
                <div className="text-sm font-medium text-slate-600 dark:text-slate-300">
                  Syncing...
                </div>
              </div>
            )}

            <div className="w-full bg-white dark:bg-slate-800 shadow-sm border-b border-slate-200 dark:border-slate-700 sticky top-0 z-40 transition-colors duration-300">
              {/* Top Toolbar */}
              <div
                className={`bg-slate-900 dark:bg-black text-slate-100 px-4 ${styles.topBarPadding} flex items-center justify-between text-xs`}
              >
                <div className="flex items-center gap-3">
                  <div className="flex items-center gap-2">
                    <span className="text-slate-400 uppercase tracking-wider font-bold">
                      Project:
                    </span>
                    <select
                      value={activeProjectId}
                      onChange={(e) => setActiveProjectId(e.target.value)}
                      className="bg-slate-800 text-white px-2 py-0.5 rounded border border-slate-700 outline-none focus:border-blue-500 hover:bg-slate-700 cursor-pointer text-xs"
                    >
                      {projects.map((p) => (
                        <option key={p.id} value={p.id}>
                          {p.name}
                        </option>
                      ))}
                    </select>
                  </div>
                  <div className="h-3 w-px bg-slate-700"></div>
                  <button
                    onClick={handleCreateProject}
                    className="hover:text-white text-slate-300 hover:underline"
                  >
                    New Project
                  </button>
                  <div className="h-3 w-px bg-slate-700"></div>
                  <div className="flex items-center gap-1.5 text-slate-400">
                    <SheetIcon connected={isConnected} />
                    <span>{isConnected ? "Connected" : "Local"}</span>
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  <button
                    onClick={() => setIsSettingsOpen(true)}
                    className="flex items-center gap-1 text-slate-300 hover:text-white transition-colors"
                  >
                    <SettingsIcon />{" "}
                    <span className="hidden sm:inline">Settings</span>
                  </button>
                  <button
                    onClick={saveToSheet}
                    disabled={!isConnected}
                    className={`flex items-center gap-1.5 px-2.5 py-1 rounded text-[10px] font-bold tracking-wide transition-all shadow-sm ${
                      !isConnected
                        ? "bg-slate-800 text-slate-500 cursor-not-allowed border border-slate-700"
                        : hasUnsavedChanges
                        ? "bg-amber-600 hover:bg-amber-500 text-white border border-amber-600"
                        : "bg-emerald-700 hover:bg-emerald-600 text-white border border-emerald-700"
                    }`}
                  >
                    <SaveIcon /> {hasUnsavedChanges ? "SAVE" : "SAVED"}
                  </button>
                </div>
              </div>

              {/* Title & Tools */}
              <div
                className={`px-4 ${
                  isCompact ? "py-2" : "py-3"
                } flex flex-col sm:flex-row sm:items-center justify-between gap-3 bg-white dark:bg-slate-800`}
              >
                <div className="flex items-center gap-3">
                  <div className="p-1.5 rounded bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 text-slate-700 dark:text-slate-300">
                    <CalendarIcon />
                  </div>
                  <div className="flex flex-col">
                    <input
                      value={activeProject.name}
                      onChange={(e) =>
                        updateActiveProject({ name: e.target.value })
                      }
                      className={`font-bold text-slate-800 dark:text-white bg-transparent border-none outline-none focus:ring-0 p-0 placeholder-slate-300 ${
                        isCompact ? "text-lg h-6" : "text-xl h-7"
                      }`}
                      placeholder="Untitled Project"
                    />
                    <span className="text-[10px] text-slate-500 dark:text-slate-400">
                      Timeline Dashboard Manager
                    </span>
                  </div>
                </div>

                <div className="flex p-0.5 bg-slate-100 dark:bg-slate-700 rounded border border-slate-200 dark:border-slate-600">
                  <button
                    onClick={() => setView("timeline")}
                    className={`flex items-center gap-1.5 px-3 py-1 rounded text-xs font-medium transition-all ${
                      view === "timeline"
                        ? "bg-white dark:bg-slate-600 text-slate-800 dark:text-white shadow-sm"
                        : "text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"
                    }`}
                  >
                    <LayoutIcon /> Timeline
                  </button>
                  <button
                    onClick={() => setView("dashboard")}
                    className={`flex items-center gap-1.5 px-3 py-1 rounded text-xs font-medium transition-all ${
                      view === "dashboard"
                        ? "bg-white dark:bg-slate-600 text-blue-700 dark:text-blue-400 shadow-sm"
                        : "text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"
                    }`}
                  >
                    <BarChartIcon /> Dashboard
                  </button>
                </div>

                {view === "timeline" && (
                  <div className="flex items-center gap-2">
                    <button
                      onClick={handleDeleteProject}
                      className="px-2 py-1 text-slate-500 dark:text-slate-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded transition-colors text-xs font-medium border border-transparent hover:border-red-100 flex items-center gap-1"
                    >
                      <TrashIcon />{" "}
                      <span className="hidden sm:inline">Del</span>
                    </button>
                    <button
                      onClick={addTask}
                      className="px-3 py-1 bg-blue-700 hover:bg-blue-800 text-white rounded shadow-sm text-xs font-medium transition-colors flex items-center gap-1.5 border border-blue-800"
                    >
                      <PlusIcon /> Add Task
                    </button>
                  </div>
                )}
              </div>
            </div>

            {/* Content */}
            {view === "dashboard" ? (
              <DashboardView project={activeProject} isCompact={isCompact} />
            ) : (
              <div className="p-4">
                <div className="bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded shadow-sm overflow-hidden transition-colors duration-300">
                  <div className="overflow-x-auto">
                    <table className="w-full border-collapse min-w-[1000px]">
                      <thead>
                        <tr
                          className={`bg-slate-50 dark:bg-slate-900 border-b border-slate-300 dark:border-slate-700 text-slate-600 dark:text-slate-400 ${styles.headerText} font-bold uppercase tracking-wider`}
                        >
                          <th
                            className={`p-1 border-r border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 sticky left-0 z-30 w-8`}
                            rowSpan="3"
                          ></th>
                          <th
                            ref={sidebarRef}
                            style={{
                              width: `${sidebarWidth}px`,
                              minWidth: `${sidebarWidth}px`,
                              maxWidth: `${sidebarWidth}px`,
                              left: `${styles.gripWidth}px`,
                            }}
                            className={`p-1.5 border-r border-slate-300 dark:border-slate-700 text-left sticky z-30 bg-slate-50 dark:bg-slate-900 relative group`}
                            rowSpan="3"
                          >
                            <div className="flex justify-between items-center h-full px-1">
                              <span>Task Description</span>
                            </div>
                            <div
                              className="resizer group-hover:bg-blue-400"
                              onMouseDown={startResizing}
                            ></div>
                          </th>
                          {Object.entries(weeks).map(([wId, cols]) => (
                            <th
                              key={wId}
                              className="p-1 border-r border-slate-300 dark:border-slate-700 text-center bg-slate-100 dark:bg-slate-800/50"
                              colSpan={cols.length}
                            >
                              <input
                                value={activeProject.weekLabels[wId]}
                                onChange={(e) =>
                                  handleWeekLabelChange(wId, e.target.value)
                                }
                                className={`w-full bg-transparent text-center outline-none focus:text-blue-700 dark:focus:text-blue-400 uppercase tracking-widest text-slate-500 dark:text-slate-400 font-bold ${styles.headerText}`}
                              />
                            </th>
                          ))}
                          <th
                            className="p-1 border-l border-slate-300 dark:border-slate-700 w-12 sticky right-0 bg-slate-50 dark:bg-slate-900 z-20"
                            rowSpan="3"
                          >
                            Act
                          </th>
                        </tr>
                        <tr
                          className={`bg-white dark:bg-slate-800 border-b border-slate-300 dark:border-slate-700 text-slate-600 dark:text-slate-400 ${styles.inputFontSize} font-semibold uppercase`}
                        >
                          {activeProject.columns.map((c) => (
                            <th
                              key={`d-${c.id}`}
                              className="p-1 border-r border-slate-200 dark:border-slate-700 text-center min-w-[60px] bg-slate-50 dark:bg-slate-900/50"
                            >
                              {c.day}
                            </th>
                          ))}
                        </tr>
                        <tr className="bg-white dark:bg-slate-800 border-b border-slate-300 dark:border-slate-700">
                          {activeProject.columns.map((c) => (
                            <th
                              key={`t-${c.id}`}
                              className={`p-0 border-r border-slate-200 dark:border-slate-700 ${styles.headerHeight}`}
                            >
                              <input
                                value={c.time}
                                onChange={(e) =>
                                  handleTimeChange(c.id, e.target.value)
                                }
                                className={`w-full h-full text-center bg-transparent outline-none text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 focus:bg-blue-50 dark:focus:bg-slate-700 focus:text-blue-800 dark:focus:text-blue-300 transition-colors ${styles.inputFontSize}`}
                              />
                            </th>
                          ))}
                        </tr>
                      </thead>
                      <tbody className="divide-y divide-slate-200 dark:divide-slate-700">
                        {activeProject.tasks.map((task, idx) => (
                          <tr
                            key={task.id}
                            draggable
                            onDragStart={(e) => handleDragStart(e, idx)}
                            onDragEnter={(e) => handleDragEnter(e, idx)}
                            onDragEnd={() => (dragItem.current = null)}
                            onDragOver={(e) => e.preventDefault()}
                            className="group hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors"
                          >
                            <td
                              className={`p-0 border-r border-slate-200 dark:border-slate-700 sticky left-0 z-20 bg-white dark:bg-slate-800 group-hover:bg-slate-50 dark:group-hover:bg-slate-700/50 w-8`}
                            >
                              <div
                                className={`${styles.rowHeight} w-full flex justify-center items-center cursor-grab active:cursor-grabbing opacity-40 group-hover:opacity-100 transition-opacity text-slate-400 dark:text-slate-500`}
                              >
                                <GripVerticalIcon />
                              </div>
                            </td>
                            <td
                              style={{
                                width: `${sidebarWidth}px`,
                                minWidth: `${sidebarWidth}px`,
                                maxWidth: `${sidebarWidth}px`,
                                left: `${styles.gripWidth}px`,
                              }}
                              className="p-0 border-r border-slate-200 dark:border-slate-700 sticky z-20 bg-white dark:bg-slate-800 group-hover:bg-slate-50 dark:group-hover:bg-slate-700/50 shadow-sm"
                            >
                              <input
                                value={task.name}
                                onChange={(e) =>
                                  handleTaskNameChange(task.id, e.target.value)
                                }
                                className={`w-full ${styles.rowHeight} px-3 bg-transparent outline-none ${styles.fontSize} text-slate-700 dark:text-slate-200 font-medium truncate placeholder-slate-300 dark:placeholder-slate-600`}
                                placeholder="Enter task..."
                              />
                            </td>
                            {activeProject.columns.map((c) => {
                              const isActive = task.activeSlots.includes(c.id)
                              return (
                                <td
                                  key={`${task.id}-${c.id}`}
                                  onClick={() => toggleSlot(task.id, c.id)}
                                  className={`border-r border-slate-200 dark:border-slate-700 cursor-pointer ${
                                    styles.rowHeight
                                  } transition-all duration-150 relative ${
                                    isActive
                                      ? "bg-blue-700 dark:bg-blue-600 shadow-inner"
                                      : "bg-transparent hover:bg-slate-100 dark:hover:bg-slate-700"
                                  }`}
                                >
                                  <div className="opacity-0 group-hover/cell:opacity-100 absolute bottom-full left-1/2 -translate-x-1/2 mb-1 px-1.5 py-0.5 bg-slate-800 text-white text-[9px] rounded pointer-events-none z-50 whitespace-nowrap hidden">
                                    {c.day} {c.time}
                                  </div>
                                </td>
                              )
                            })}
                            <td className="p-0 text-center sticky right-0 bg-white dark:bg-slate-800 group-hover:bg-slate-50 dark:group-hover:bg-slate-700/50 border-l border-slate-200 dark:border-slate-700 z-20 w-12">
                              <button
                                onClick={() => deleteTask(task.id)}
                                className="w-6 h-6 inline-flex items-center justify-center text-slate-300 dark:text-slate-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-full transition-colors"
                              >
                                <TrashIcon />
                              </button>
                            </td>
                          </tr>
                        ))}
                        {activeProject.tasks.length === 0 && (
                          <tr>
                            <td
                              colSpan={activeProject.columns.length + 3}
                              className="p-8 text-center text-slate-400 bg-slate-50 dark:bg-slate-800/30 border-dashed border-2 border-slate-200 dark:border-slate-700 m-4 rounded-lg text-xs"
                            >
                              No tasks available.
                            </td>
                          </tr>
                        )}
                      </tbody>
                      <tfoot>
                        <tr className="bg-slate-50 dark:bg-slate-900 border-t border-slate-300 dark:border-slate-700">
                          <td
                            colSpan="2"
                            className={`p-1 sticky left-0 z-20 bg-slate-50 dark:bg-slate-900 text-right ${styles.inputFontSize} font-bold text-slate-400 uppercase tracking-widest pr-3 border-r border-slate-200 dark:border-slate-700 ${styles.headerHeight} align-middle`}
                          >
                            Remove:
                          </td>
                          {activeProject.columns.map((c) => (
                            <td
                              key={`del-${c.id}`}
                              className={`p-0 text-center border-r border-slate-200 dark:border-slate-700 ${styles.headerHeight} align-middle`}
                            >
                              <button
                                onClick={() => deleteColumn(c.id)}
                                className="p-1 text-slate-300 dark:text-slate-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors inline-flex"
                              >
                                <XCircleIcon />
                              </button>
                            </td>
                          ))}
                          <td className="p-1 sticky right-0 bg-slate-50 dark:bg-slate-900 border-l border-slate-200 dark:border-slate-700"></td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </div>

                <div className="mt-4 flex flex-col sm:flex-row justify-between items-start sm:items-center text-[10px] text-slate-500 dark:text-slate-400 gap-3">
                  <div className="flex gap-4">
                    <div className="flex items-center gap-1.5">
                      <span className="w-2.5 h-2.5 bg-blue-700 dark:bg-blue-600 border border-blue-800 dark:border-blue-500 rounded-sm block shadow-sm"></span>
                      <span>Scheduled</span>
                    </div>
                    <div className="flex items-center gap-1.5">
                      <span className="w-2.5 h-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-sm block shadow-sm"></span>
                      <span>Available</span>
                    </div>
                  </div>
                  <div>
                    Status:{" "}
                    <span
                      className={
                        isConnected
                          ? "text-emerald-600 dark:text-emerald-400 font-semibold"
                          : "text-amber-600 dark:text-amber-400 font-semibold"
                      }
                    >
                      {isConnected ? "Online DB" : "Local Mode"}
                    </span>
                  </div>
                </div>
              </div>
            )}

            {/* Settings Modal */}
            <Modal
              isOpen={isSettingsOpen}
              onClose={() => setIsSettingsOpen(false)}
              title="Dashboard Settings"
            >
              <div className="space-y-4">
                <div className="p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded text-xs text-blue-800 dark:text-blue-200">
                  <strong>Google Sheets Integration</strong>
                  <br />
                  Sync data with your Google Sheet for collaboration.
                </div>

                <div>
                  <label className="block text-xs font-bold text-slate-700 dark:text-slate-300 mb-1 uppercase tracking-wide">
                    Web App URL
                  </label>
                  <div className="flex gap-2">
                    <input
                      type="text"
                      value={scriptUrl}
                      onChange={(e) => setScriptUrl(e.target.value)}
                      placeholder="https://script.google.com/..."
                      className="flex-1 p-2 border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-200 rounded text-xs focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none"
                    />
                    <button
                      onClick={handleConnect}
                      className="px-3 py-1.5 bg-blue-600 text-white rounded text-xs font-bold hover:bg-blue-700 transition-colors"
                    >
                      Connect
                    </button>
                  </div>
                </div>

                <div className="border-t border-slate-200 dark:border-slate-700 my-4"></div>

                <div>
                  <label className="block text-xs font-bold text-slate-700 dark:text-slate-300 mb-2 uppercase tracking-wide">
                    Appearance
                  </label>
                  <ToggleSwitch
                    label="Dark Mode"
                    checked={isDarkMode}
                    onChange={setIsDarkMode}
                    icon={<MoonIcon />}
                  />
                  <ToggleSwitch
                    label="Compact Mode"
                    checked={isCompact}
                    onChange={setIsCompact}
                    icon={<LayoutIcon />}
                  />
                </div>
              </div>
            </Modal>
          </div>
        )
      }

      const root = ReactDOM.createRoot(document.getElementById("root"))
      root.render(<ProjectTimelineDashboard />)
    </script>
  </body>
</html>
